<table mat-table [dataSource]="dataSource()" class="mat-elevation-z8">
  <!-- ID Column -->
  <ng-container matColumnDef="id">
    <th mat-header-cell *matHeaderCellDef> ID </th>
    <td mat-cell *matCellDef="let intent"> {{ intent.id }} </td>
  </ng-container>

  <!-- Recipient email Column -->
  <ng-container matColumnDef="recipientEmail">
    <th mat-header-cell *matHeaderCellDef> Recipient </th>
    <td mat-cell *matCellDef="let intent"> {{ intent.recipientEmail }} </td>
  </ng-container>

  <!-- Description Column -->
  <ng-container matColumnDef="description">
    <th mat-header-cell *matHeaderCellDef> Description </th>
    <td mat-cell *matCellDef="let intent"> {{ intent.description }} </td>
  </ng-container>

  <!-- Status Column -->
  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef> Status </th>
    <td mat-cell *matCellDef="let intent"> {{ intent.status }} </td>
  </ng-container>

  <!-- Amount Column -->
  <ng-container matColumnDef="amount">
    <th mat-header-cell *matHeaderCellDef> Amount </th>
    <td mat-cell *matCellDef="let intent"> {{ intent.amount }} </td>
  </ng-container>

  <!-- Actions Column -->
  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef> Actions </th>
    <td mat-cell *matCellDef="let intent" (click)="$event.stopPropagation()">
      <!-- <button mat-button color="primary" [routerLink]="['/invoice', intent.id, 'detail']">View</button> -->
      <!-- <button mat-button color="primary" (click)="selectForDetailView(intent.id)">View</button> -->
      <button mat-button color="primary">View</button>
      <button mat-button color="warn" (click)="cancel(intent.id)" [disabled]="intent.status === 'canceled' || intent.status === 'succeeded'">Cancel</button>
      @if (intent.intent.status === 'requires_payment_method') {
        <button class="trailing-icon" mat-button color="accent" [routerLink]="['/payment']" [queryParams]="{ pi: intent.id }">
            <span>Pay</span>
            <mat-icon>attach_money</mat-icon>
        </button>
      } @else {
        <button class="trailing-icon" mat-button color="accent" (click)="openReceipt(intent)" *ngIf="intent.intent['latest_charge']">
            <span>Receipt</span>
            <mat-icon>open_in_new</mat-icon>
        </button>
        <!-- <a href="https://example.com" target="_blank" rel="noopener" class="mat-button">
            <span>Receipt</span>
            <mat-icon class="ml-2 align-middle icon-small">open_in_new</mat-icon>
        </a> -->
      }
    </td>
  </ng-container>

  
  <!-- Expand/Collapse Column -->
  <ng-container matColumnDef="expand">
    <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
    <td mat-cell *matCellDef="let row">
      <button mat-icon-button aria-label="expand row" (click)="toggleRow(row); $event.stopPropagation()">
        @if (selectedRow()?.id === row?.id) {
          <mat-icon>expand_less</mat-icon>
        } @else {
          <mat-icon>expand_more</mat-icon>
        }
      </button>
    </td>
  </ng-container>

<!-- <tr mat-row *matRowDef="let row; columns: displayedColumns;"
    (click)="onRowClick(row)"
    [class.expanded]="row.id === selectedRow()?.id">
</tr> -->
<!-- <tr mat-row *matRowDef="let row; columns: ['detail']" class="detail-row"
    [@detailExpand]="row.id === selectedRow()?.id ? 'expanded' : 'collapsed'">
  <td [attr.colspan]="displayedColumns.length">
    <div *ngIf="row.id === selectedRow()?.id" class="detail-content">
      <strong>Full Description:</strong> {{ row.description }}
      <br>
      <strong>Recipient Email:</strong> {{ row.recipientEmail }}
    </div>
  </td>
</tr> -->

<!--   <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"
        [class.active-row]="row.id === activeRowId()"
        (click)="setSelectedItemByRowId(row.id)">
    </tr> -->
    
  <ng-container matColumnDef="expandedDetail">
    <td mat-cell *matCellDef="let row" [attr.colspan]="displayedColumns.length">
      <div class="detail-content" *ngIf="selectedRow()?.id === row?.id">
        <app-invoice-detail [detail]="row.intent"></app-invoice-detail>
      </div>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns; when: isMainRow"
      (click)="toggleRow(row)"
      [class.expanded]="selectedRow()?.id === row?.id"></tr>
  <tr mat-row *matRowDef="let row; columns: ['expandedDetail']; when: isExpansionDetailRow" class="detail-row"></tr>

</table>
